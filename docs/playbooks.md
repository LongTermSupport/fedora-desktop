# Playbooks Reference

Complete catalog of available features and how to use them.

## Quick Navigation

**Just installed?** Start with [Optional Playbooks](#optional-playbooks) to see what you can add.

**Creating your own?** See [Creating Custom Playbooks](#creating-custom-playbooks) for templates.

**Common tasks:**
- [Install Docker](#play-dockeryml) - Rootless Docker setup
- [Set up Distrobox](#play-install-distroboxyml) - Seamless dev environments
- [Python development](#play-pythonyml) - pyenv and PDM
- [Playwright testing](#play-distrobox-playwrightyml) - Automated browser testing

## Core Playbooks (Automatically Run)

These playbooks are executed automatically by `playbook-main.yml` during initial installation:

### play-AA-preflight-sanity.yml
**Purpose**: Validates system requirements  
**Actions**:
- Verifies Ansible version >= 2.9.9
- Confirms Fedora distribution and version
- Ensures system matches target in `vars/fedora-version.yml`

### play-basic-configs.yml
**Purpose**: Essential system configuration  
**Actions**:
- Installs basic packages (vim, wget, bash-completion, htop, etc.)
- Configures passwordless sudo for user
- Sets up Vim with Deus colorscheme
- Configures bash environment and custom PS1 prompt
- Copies SSH keys to root user
- Installs YQ binary
- Optimizes DNF with parallel downloads
- Configures hardware settings

### play-nvm-install.yml
**Purpose**: Node.js environment setup  
**Actions**:
- Installs Node Version Manager (NVM)
- Installs Node.js version 20
- Sets up bash integration

### play-claude-code.yml
**Purpose**: Claude Code CLI installation  
**Actions**:
- Downloads and installs Claude Code binary
- Configures system-wide access

### play-git-configure-and-tools.yml
**Purpose**: Git environment configuration  
**Actions**:
- Configures git user name and email
- Installs bash-git-prompt with Solarized theme
- Sets up ripgrep for fast searching
- Installs GitHub CLI (gh)
- Note: SSH keys are generated by run.bash as ~/.ssh/id (Ed25519)
- Configures SSH for LXC containers

### play-lxc-install-config.yml
**Purpose**: Container support  
**Actions**:
- Installs LXC and LXD packages
- Configures container networking
- Sets up SSH configuration for containers
- Configures firewall rules

### play-ms-fonts.yml
**Purpose**: Microsoft fonts installation  
**Actions**:
- Installs Windows-compatible fonts
- Configures font rendering

### play-rpm-fusion.yml
**Purpose**: Third-party repository setup  
**Actions**:
- Enables RPM Fusion free and non-free repositories
- Required for many multimedia codecs and proprietary software

### play-toolbox-install.yml
**Purpose**: JetBrains Toolbox installation  
**Actions**:
- Downloads and installs JetBrains Toolbox
- Configures desktop integration

## Optional Playbooks

Run these manually as needed after the main installation completes.

**General syntax:**
```bash
cd ~/Projects/fedora-desktop
ansible-playbook playbooks/imports/optional/<category>/<playbook>.yml
```

**Note:** Most optional playbooks don't require `--ask-become-pass` as they use sudo internally. If prompted for a password, just enter your sudo password.

### Common Optional Features

Popular add-ons for development work:

#### play-install-flatpaks.yml
Installs Flatpak applications:
- Enables Flathub repository
- Installs Slack

#### play-docker.yml
Docker container platform:
- Adds Docker repository
- Installs Docker CE and tools
- Configures rootless Docker (user systemd service)
- Configures subuid/subgid for user namespaces
- See [Containerization Guide](containerization.md) for details

#### play-install-distrobox.yml
Distrobox installation:
- Installs distrobox package
- Provides seamless container integration for development
- Enables running GUI apps from other distros
- Auto-shares home directory with containers
- See [Containerization Guide](containerization.md) for comparison with LXC/Docker

#### play-distrobox-playwright.yml
Playwright browser testing environment:
- Creates shared `playwright-tests` container (Ubuntu 22.04)
- Installs Node.js LTS v20
- Installs Playwright browsers (Chromium, Firefox, WebKit)
- Provides GUI support for visible testing
- Shared across all projects in ~/Projects/
- Each project maintains own dependencies
- Adds `playwright-test` alias and helper commands
- Includes `playwright-distrobox` management script
- **Requires**: `play-install-distrobox.yml` must be run first

**Benefits**:
- Zero Fedora desktop pollution (all tools in container)
- ~400MB browsers shared across projects
- Different Playwright versions per project supported
- Browser windows appear on desktop

**Usage**:
```bash
# Quick access
playwright-test  # Enter container

# Management
playwright-distrobox status    # Show status
playwright-distrobox update    # Update browsers
playwright-distrobox recreate  # Rebuild container
```

#### play-firefox.yml
Firefox enhancements:
- Installs Firefox package
- Installs Firefox Profile Switcher Connector
- Sets up policies from files/etc/firefox/policies/policies.json

#### play-github-cli-multi.yml
Multi-account GitHub CLI configuration:
- Configures multiple GitHub accounts
- Sets up account switching
- Manages authentication tokens

#### play-gnome-shell.yml & play-gnome-shell-extensions.yml
GNOME desktop customization:
- Installs shell extensions
- Configures extension settings

#### play-golang.yml
Go programming language:
- Installs Go compiler and tools

#### play-gsettings.yml
Desktop settings configuration:
- Applies custom GNOME settings via gsettings

#### play-hd-audio.yml
Audio system enhancements:
- Configures PipeWire for high-quality audio
- Sets up Bluetooth audio codecs
- Optimizes audio latency

#### play-python.yml
Python development environment:
- Installs Python packages
- Configures pyenv for version management
- Sets up PDM package manager
- Installs Hugging Face tools

#### play-vscode.yml
Visual Studio Code installation:
- Adds Microsoft repository
- Installs VS Code

#### play-vpn.yml
VPN client setup:
- Installs WireGuard tools
- Configures VPN connections

#### play-cloudflare-warp.yml
Cloudflare WARP client:
- Installs WARP VPN client

#### play-lastpass.yml
Password manager:
- Installs LastPass CLI
- Configures accounts

#### play-qobuz-cli.yml
Music streaming:
- Installs Qobuz CLI tools
- Configures Last.fm scrobbling
- Sets up rescrobbled service

### Hardware-Specific

#### play-nvidia.yml
NVIDIA GPU drivers:
- Installs proprietary NVIDIA drivers
- Configures kernel modules

#### play-displaylink.yml
DisplayLink dock support:
- Installs DisplayLink drivers
- Creates suspend/resume service
- Configures display management

### Experimental

#### play-docker-in-lxc-support.yml
Docker-in-LXC support:
- Configures host for Docker inside LXC containers
- Loads kernel modules (overlay, br_netfilter)
- Configures sysctl for IP forwarding
- Enables user namespaces for rootless Docker
- Installs `docker-in-lxc` command for project-based containers
- **Requires**: `play-lxc-install-config.yml` (core)
- See [Containerization Guide](containerization.md) for advanced use cases

**Usage**:
```bash
cd ~/Projects/my-docker-project
docker-in-lxc --create  # Create LXC for this project
docker-in-lxc --enter   # Enter the container
# Inside: docker-compose up
```

#### play-lxde-install.yml
Lightweight desktop environment:
- Installs LXDE as alternative to GNOME

#### play-virtualbox-windows.yml
Windows virtualization:
- Installs VirtualBox
- Configures Windows VM support
- Sets up ACPI tools

### Archived

#### play-tlp-battery-optimisation.yml
Laptop power management (deprecated):
- TLP battery optimization
- Note: Conflicts with newer power-profiles-daemon

## Running Optional Playbooks

```bash
# Install Flatpak applications
ansible-playbook playbooks/imports/optional/common/play-install-flatpaks.yml

# Set up Docker
ansible-playbook playbooks/imports/optional/common/play-docker.yml

# Install Distrobox
ansible-playbook playbooks/imports/optional/common/play-install-distrobox.yml

# Set up Playwright testing environment (requires distrobox)
ansible-playbook playbooks/imports/optional/common/play-distrobox-playwright.yml

# Install NVIDIA drivers
ansible-playbook playbooks/imports/optional/hardware-specific/play-nvidia.yml

# Configure multiple GitHub accounts
ansible-playbook playbooks/imports/optional/common/play-github-cli-multi.yml

# Advanced: Docker-in-LXC support
ansible-playbook playbooks/imports/optional/experimental/play-docker-in-lxc-support.yml
```

## Creating Custom Playbooks

Place custom playbooks in `playbooks/imports/optional/` following the naming convention `play-<feature>.yml`.

Template:
```yaml
- hosts: desktop
  name: Your Feature Name
  become: true  # If root required
  vars:
    root_dir: "{{ inventory_dir }}/../../"
  vars_files:
    - "{{ root_dir }}/vars/fedora-version.yml"  # If version-specific
  tasks:
    - name: Your task here
      package:
        name: your-package
        state: present
```