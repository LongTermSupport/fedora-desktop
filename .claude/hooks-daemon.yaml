version: "1.0"

# Daemon configuration
daemon:
  idle_timeout_seconds: 600  # Auto-shutdown after 10 minutes of inactivity
  log_level: INFO

  enable_hello_world_handlers: false  # Disable hello_world test handlers
                                      # Set to true to see "âœ… {Event} hook system active" messages

# Built-in handler configuration
# Handlers run in priority order (lower number = earlier execution)
# Priority ranges: 5=test, 10-20=safety, 25-45=workflow, 50-60=tool usage
handlers:
  # PreToolUse handlers (run before every tool call)
  pre_tool_use:
    # SAFETY HANDLERS (Priority 10-20)
    destructive_git:       # Blocks git reset --hard, git clean -f, etc
      enabled: true
      priority: 10

    sed_blocker:           # Blocks sed command usage (use Edit tool instead)
      enabled: true
      priority: 10

    absolute_path:         # Enforces absolute paths in file operations
      enabled: true
      priority: 12

    worktree_file_copy:    # Prevents copying files between git worktrees
      enabled: true
      priority: 15

    git_stash:             # Warns about git stash (stashes can be lost)
      enabled: true
      priority: 20

    # CODE QUALITY HANDLERS (Priority 25-45)
    qa_suppression:        # Prevents QA suppression comments (replaces eslint_disable in v2.9.0+)
      enabled: true
      priority: 30

    tdd_enforcement:       # Enforces test-first development
      enabled: true
      priority: 35

    # WORKFLOW HANDLERS (Priority 40-50)
    validate_plan_number:  # Validates plan number format (001-, 002-, etc)
      enabled: true        # Enabled for CLAUDE/Plan/ workflow
      priority: 40

    plan_time_estimates:   # Blocks time estimates in plan files
      enabled: true        # Enabled for CLAUDE/Plan/ workflow
      priority: 45

    plan_workflow:         # Provides guidance when creating plans
      enabled: true        # Enabled for CLAUDE/Plan/ workflow
      priority: 45

    npm_command:           # Restricts npm commands to approved list
      enabled: true        # Enabled for strict npm usage control
      priority: 50

    markdown_organization: # Enforces markdown file organization rules
      enabled: true        # Enabled for strict md organization
      priority: 50
      options:
        allowed_markdown_paths:
          - "^src/claude_code_hooks_daemon/guides/.*\\.md$"  # Shipped daemon guides
          - "^claude/.*\\.md$"                               # LLM docs (CLAUDE/)
          - "^docs/.*\\.md$"                                 # Human-facing docs
          - "^untracked/.*\\.md$"                            # Temporary/scratch docs
          - "^releases/.*\\.md$"                             # Release notes
          - "^eslint-rules/.*\\.md$"                         # ESLint rule docs
          - "^files/opt/claude-yolo/skills/.*\\.md$"         # Container-deployed skill docs

    # TOOL USAGE HANDLERS (Priority 50-60)
    web_search_year:       # Fixes year in web search queries (uses current year)
      enabled: true
      priority: 55

    british_english:       # Warns about American English spelling
      enabled: true
      priority: 60

  # PostToolUse handlers (run after tool execution)
  post_tool_use:
    validate_eslint_on_write:  # Runs ESLint after file writes
      enabled: true            # Enabled for automatic ESLint validation
      priority: 10


  # SessionStart handlers (run when session starts)
  session_start:
    yolo_container_detection:     # Detects YOLO container environments (enabled by default)
      enabled: true                # Set to false to disable YOLO detection
      priority: 40                 # Workflow range priority

    workflow_state_restoration:  # Restores workflow state after compaction
      enabled: true              # Enabled for workflow state management
      priority: 10

  # PreCompact handlers (run before conversation compaction)
  pre_compact:
    workflow_state_pre_compact:  # Saves workflow state before compaction
      enabled: true              # Enabled for workflow state management
      priority: 10

  # SessionEnd handlers (run when session ends)
  session_end: {}

  # SubagentStop handlers (run when subagent completes)
  subagent_stop:
    remind_prompt_library:  # Reminds about prompt library after agent work
      enabled: true         # Enabled for prompt library reminders
      priority: 10


  # UserPromptSubmit handlers (run when user submits prompt)
  user_prompt_submit:
    # Note: auto_continue handler removed in v2.10.0
    git_context_injector:  # Injects git status as context
      enabled: true
      priority: 10

  # StatusLine handlers (run to populate status line display)
  status_line:
    git_repo_name:      # Shows repository name (cached for performance)
      enabled: true
      priority: 5  # Changed from 3 (minimum is 5)

    account_display:    # Shows Claude account username
      enabled: true
      priority: 5

    model_context:      # Shows color-coded model name and context percentage
      enabled: true
      priority: 10

    git_branch:         # Shows current git branch
      enabled: true
      priority: 20

    daemon_stats:       # Shows daemon uptime, memory, log level, errors
      enabled: true
      priority: 30

  # Other hook events
  permission_request: {}
  notification: {}
  stop: {}

# Project-level handlers (custom handlers in .claude/hooks/handlers/)
plugins:
  paths: []
  plugins:
    # Custom Infrastructure-as-Code enforcement handlers
    - path: ".claude/hooks/handlers/pre_tool_use/system_paths.py"
      event_type: "pre_tool_use"
      handlers: ["SystemPathsHandler"]
      enabled: true

    - path: ".claude/hooks/handlers/pre_tool_use/ansible_enforcement.py"
      event_type: "pre_tool_use"
      handlers: ["AnsibleEnforcementHandler"]
      enabled: true
